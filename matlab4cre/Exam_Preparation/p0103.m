% Practical 1
% Exercise  3

% Reactions in Parallel in a CSTR

close all
clear variables
clc

% -------------------------------------------------------------------------
% Data
% -------------------------------------------------------------------------

SC = [-1 -1; 1 0; 0 1];

Q = 4;          % [liter/min]
Cin = 2;        % [mol/liter]
CAin = Cin;

k1 = 0.5;           % [1/min]
k2 = 0.1;           % [1/min]

X_target = 0.95;    % [-]

% -------------------------------------------------------------------------
% Solution 1: Incrementing The Residence Time
% -------------------------------------------------------------------------

for tau = 1:100
    
    CA = CAin/(1 + (k1 + k2)*tau);
    CB = CA*k1*tau/(1 + k2*tau);    
    
    X = (CAin - CA)/CAin;
    
    if X >= X_target
        break
    end
end

Yb = CB/CAin;
Sb_a = CB/(CAin - CA);

V = tau*Q;

% -------------------------------------------------------------------------
% Results
% -------------------------------------------------------------------------

disp('Solution 1')
fprintf('X = %f [-] @ tau = %f [min]; V = %f [liter] \n', X, tau, V)
fprintf('Yb = %f [-]; Sb_a = %f [-] \n', Yb, Sb_a);

% -------------------------------------------------------------------------
% Solution 2: Explicit Solution
% -------------------------------------------------------------------------

X = X_target;
CA = (1 - X)*CAin;
tau = (CAin - CA)/(k1 + k2)/CA;

Yb = CB/CAin;
Sb_a = CB/(CAin - CA);

V = tau*Q;

% -------------------------------------------------------------------------
% Results
% -------------------------------------------------------------------------

disp('Solution 2')
fprintf('X = %f [-] @ tau = %f [min]; V = %f [liter] \n', X, tau, V)
fprintf('Yb = %f [-]; Sb_a = %f [-] \n', Yb, Sb_a);

% -------------------------------------------------------------------------
% Maximize Yb
% -------------------------------------------------------------------------

CA = zeros(1, 100);
CB = zeros(1, 100);
tau = 1:100;

for ii = 1:100
 
    CA(ii) = CAin/(1 + (k1 + k2)*tau(ii));
    CB(ii) = CA(ii)*k1*tau(ii)/(1 + k2*tau(ii));    
    
    X(ii) = (CAin - CA(ii))/CAin;
    
end

Yb = CB/CAin;
Sb_a = CB./(CAin - CA);

V = tau*Q;

% -------------------------------------------------------------------------
% Results
% -------------------------------------------------------------------------

[maxYb, ii_max] = max(Yb);
tau_max = tau(ii_max);
V_max = V(ii_max);

disp('Maximize Yb')
fprintf('YB max = %f [-] @ tau = %f [min], V = %f [liter] \n', maxYb, tau_max, V_max)

% -------------------------------------------------------------------------
% Graphical Post Processing
% -------------------------------------------------------------------------

figure 
plot(V, Yb)
title('Yield of B vs. Volume')

% -------------------------------------------------------------------------
% Functions
% -------------------------------------------------------------------------
